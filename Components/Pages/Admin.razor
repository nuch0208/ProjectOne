@page "/admin"
@layout ProjectOne.Components.Layout.MinimalLayout
@rendermode InteractiveServer
@using Blazored.LocalStorage
@inject NavigationManager Nav
@inject ILocalStorageService LocalStorage


@if (!ready)
{
    <div class="container py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
}
else
{
   <div class="admin-landing">

    <section class="admin-hero">
        <div class="container-xl">
            <div class="admin-hero-badge">ADMIN</div>
            <h1 class="admin-hero-title">Admin Menu</h1>
            @* <div class="admin-hero-subtitle">Click a button to open the screen.</div>

            <div class="admin-hero-tags">
                <span>Green</span>
                <span>Teal</span>
                <span>Clean UI</span>
            </div> *@
        </div>
    </section>

    <section class="admin-menu-wrap">
        <div class="container-xl">

            <div class="admin-menu-grid">

                <div class="admin-menu-card2">
                    <div class="admin-menu-emoji">üóÇÔ∏è</div>
                    <div class="admin-menu-label">CATEGORIES</div>
                    <button type="button" class="admin-menu-btn" @onclick="GoCategories">
                        Edit
                    </button>
                </div>

                <div class="admin-menu-card2">
                    <div class="admin-menu-emoji">üì¶</div>
                    <div class="admin-menu-label">PRODUCTS</div>
                    <button type="button" class="admin-menu-btn" @onclick="GoProducts">
                        Edit
                    </button>
                </div>

                <div class="admin-menu-card2">
                    <div class="admin-menu-emoji">üñºÔ∏è</div>
                    <div class="admin-menu-label">IMAGES</div>
                    <button type="button" class="admin-menu-btn" @onclick="GoProducts">
                        Edit
                    </button>
                </div>

                <div class="admin-menu-card2">
                    <div class="admin-menu-emoji">‚öôÔ∏è</div>
                    <div class="admin-menu-label">SETTINGS</div>
                    <button type="button" class="admin-menu-btn" @onclick="GoCategories">
                        Edit
                    </button>
                </div>

            </div>

            @* <div class="admin-menu-note">
                Green/Teal theme only ‚Ä¢ No images ‚Ä¢ Same layout as sample
            </div> *@
        </div>
    </section>

</div>
}

@code {

    private void GoCategories() => Nav.NavigateTo("/admin/catalog/categories");
    private void GoProducts() => Nav.NavigateTo("/admin/catalog/products");
    private bool ready;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        var token = await LocalStorage.GetItemAsync<string>("auth_token");
        var role = await LocalStorage.GetItemAsync<string>("auth_role");

        var ok = !string.IsNullOrWhiteSpace(token) &&
                 string.Equals(role, "Admin", StringComparison.OrdinalIgnoreCase);

        if (!ok)
        {
            Nav.NavigateTo("/catalog?returnUrl=/admin", true);
            return;
        }

        ready = true;
        StateHasChanged();
    }
}